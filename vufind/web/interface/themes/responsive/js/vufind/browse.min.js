VuFind.Browse=function(){return{curPage:1,curCategory:"",selectedCategory:"",addToHomePage:function(searchId){VuFind.Account.ajaxLightbox(Globals.path+"/Browse/AJAX?method=getAddBrowseCategoryForm&searchId="+searchId,true);return false},changeBrowseCategory:function(categoryTextId){var url=Globals.path+"/Browse/AJAX?method=getBrowseCategoryInfo&textId="+categoryTextId,newLabel=$("#browse-category-"+categoryTextId+" div").text();$(".browse-category").removeClass("selected");$("#browse-category-"+categoryTextId).addClass("selected");$(".selected-browse-label-text, .selected-browse-label-search-text").html(newLabel);$.getJSON(url,function(data){if(data.result==false){VuFind.showMessage("Error loading browse information","Sorry, we were not able to find titles for that category")}else{$(".selected-browse-label-text, .selected-browse-label-search-text").html(data.label);VuFind.Browse.curPage=1;VuFind.Browse.curCategory=data.textId;$("#home-page-browse-thumbnails").html(data.records);$("#selected-browse-search-link").attr("href",data.searchUrl)}});return false},createBrowseCategory:function(){var url=Globals.path+"/Browse/AJAX?method=createBrowseCategory";url+="&searchId="+$("#searchId").val();url+="&categoryName="+$("#categoryName").val();$.getJSON(url,function(data){if(data.result==false){VuFind.showMessage("Unable to create category",data.message)}else{VuFind.showMessage("Successfully added","This search was added to the homepage successfully.",true)}});return false},getMoreResults:function(){var url=Globals.path+"/Browse/AJAX?method=getMoreBrowseResults&textId="+this.curCategory+"&pageToLoad="+(this.curPage+1);$.getJSON(url,function(data){if(data.result==false){VuFind.showMessage("Error loading browse information","Sorry, we were not able to find titles for that category")}else{$("#home-page-browse-thumbnails").append(data.records);VuFind.Browse.curPage++}});return false}}}(VuFind.Browse||{});$(document).ready(function(){var browseCategoryCarousel=$("#browse-category-carousel");browseCategoryCarousel.on("jcarousel:create jcarousel:reload",function(){var element=$(this),width=element.innerWidth();if(width>700){width=width/4}else if(width>5500){width=width/3}else if(width>400){width=width/2}element.jcarousel("items").css("width",width+"px")}).on("jcarousel:targetin","li",function(){console.log("targetin called");var categoryId=$(this).data("category-id");VuFind.Browse.selectedCategory=$(this).data("category-id");VuFind.Browse.changeBrowseCategory(categoryId)});if($("#browse-category-picker .jcarousel-control-prev").css("display")!="none"){browseCategoryCarousel.find("li").click(function(){browseCategoryCarousel.jcarousel("scroll",$(this))});var scrollFactor=15;browseCategoryCarousel.touchwipe({wipeLeft:function(dx){var scrollInterval=Math.round(dx/scrollFactor);browseCategoryCarousel.jcarousel("scroll","+="+scrollInterval)},wipeRight:function(dx){var scrollInterval=Math.round(dx/scrollFactor);browseCategoryCarousel.jcarousel("scroll","-="+scrollInterval)}})}else{browseCategoryCarousel.find("li").click(function(){$(this).trigger("jcarousel:targetin")})}});