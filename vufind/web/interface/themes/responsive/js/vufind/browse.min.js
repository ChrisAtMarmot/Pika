VuFind.Browse=function(){return{curPage:1,curCategory:"",browseMode:"covers",browseModeClasses:{covers:"home-page-browse-thumbnails",grid:"home-page-browse-lists"},addToHomePage:function(searchId){VuFind.Account.ajaxLightbox(Globals.path+"/Browse/AJAX?method=getAddBrowseCategoryForm&searchId="+searchId,true);return false},initializeBrowseCategory:function(){var browseCategoryCarousel=$("#browse-category-carousel");browseCategoryCarousel.on("jcarousel:create jcarousel:reload",function(){var Carousel=$(this),width=Carousel.innerWidth();if(width>700){width/=4}else if(width>500){width/=3}else if(width>400){width/=2}Carousel.jcarousel("items").css("width",Math.floor(width)+"px")});browseCategoryCarousel.on("jcarousel:targetin","li",function(){var categoryId=$(this).data("category-id");VuFind.Browse.changeBrowseCategory(categoryId)});if($("#browse-category-picker .jcarousel-control-prev").css("display")!="none"){browseCategoryCarousel.find("li").click(function(){$("#browse-category-carousel").jcarousel("scroll",$(this))});var scrollFactor=15;browseCategoryCarousel.touchwipe({wipeLeft:function(dx){var scrollInterval=Math.round(dx/scrollFactor);$("#browse-category-carousel").jcarousel("scroll","+="+scrollInterval)},wipeRight:function(dx){var scrollInterval=Math.round(dx/scrollFactor);$("#browse-category-carousel").jcarousel("scroll","-="+scrollInterval)}})}else{browseCategoryCarousel.find("li").click(function(){$(this).trigger("jcarousel:targetin")})}},toggleBrowseMode:function(selectedMode){var mode=this.browseModeClasses.hasOwnProperty(selectedMode)?selectedMode:this.browseMode,categoryTextId=this.curCategory||$("#browse-category-carousel .selected").data("category-id");this.browseMode=mode;if(!Globals.opac&&VuFind.hasLocalStorage()){window.localStorage.setItem("browseMode",this.browseMode)}return this.changeBrowseCategory(categoryTextId)},changeBrowseCategory:function(categoryTextId){var url=Globals.path+"/Browse/AJAX",params={method:"getBrowseCategoryInfo",textId:categoryTextId||VuFind.Browse.curCategory,browseMode:this.browseMode},classes=function(){var str="",object=VuFind.Browse.browseModeClasses;for(property in object){str+=object[property]+" "}return str}(),selectedClass=this.browseModeClasses[this.browseMode],newLabel=$("#browse-category-"+categoryTextId+" div").first().text();$(".browse-category").removeClass("selected");$("#browse-category-"+categoryTextId).addClass("selected");$(".selected-browse-label-search-text").fadeOut(function(){$(this).html(newLabel).attr("href","").fadeIn()});$("#home-page-browse-results").children().fadeOut(function(){$("#home-page-browse-results").children().slice(1).remove();$("#home-page-browse-results div.row").removeClass(classes).addClass(selectedClass)});$.getJSON(url,params,function(data){if(data.result==false){VuFind.showMessage("Error loading browse information","Sorry, we were not able to find titles for that category")}else{$(".selected-browse-label-search-text").html(data.label);VuFind.Browse.curPage=1;VuFind.Browse.curCategory=data.textId;$("#home-page-browse-results div.row").html(data.records).fadeIn("slow");$("#selected-browse-search-link").attr("href",data.searchUrl)}}).fail(function(){VuFind.showMessage("Request Failed","There was an error with this AJAX Request.");$("#home-page-browse-results div").html("").show()});return false},createBrowseCategory:function(){var url=Globals.path+"/Browse/AJAX?method=createBrowseCategory";url+="&searchId="+$("#searchId").val();url+="&categoryName="+$("#categoryName").val();$.getJSON(url,function(data){if(data.result==false){VuFind.showMessage("Unable to create category",data.message)}else{VuFind.showMessage("Successfully added","This search was added to the homepage successfully.",true)}});return false},getMoreResults:function(){var url=Globals.path+"/Browse/AJAX",params={method:"getMoreBrowseResults",textId:this.curCategory,pageToLoad:this.curPage+1,browseMode:this.browseMode},divClass=this.browseModeClasses[this.browseMode];$.getJSON(url,params,function(data){if(data.result==false){VuFind.showMessage("Error loading browse information","Sorry, we were not able to find titles for that category")}else{var newDiv=$('<div class="'+divClass+' row" />').hide().append(data.records);$("."+divClass).filter(":last").after(newDiv).after("<hr>");newDiv.fadeIn("slow");VuFind.Browse.curPage++}}).fail(function(){VuFind.showMessage("Request Failed","There was an error with this AJAX Request.")});return false}}}(VuFind.Browse||{});