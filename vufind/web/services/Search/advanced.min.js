var nextGroupNumber=0;var groupSearches=new Array;function addSearch(group,term,field){if(term==undefined){term=""}if(field==undefined){field=""}var newSearch="";newSearch+="<div class='advRow'>";if(groupSearches[group]==0){newSearch+="<div class='label'>"+searchLabel+" :</div>"}else{newSearch+="<div class='label'>&nbsp;</div>"}newSearch+="<div class='terms'><input type='text' name='lookfor"+group+"[]' size='50' value='"+jsEntityEncode(term)+"'></div>";newSearch+="<div class='field'>"+searchFieldLabel+" ";newSearch+="<select name='type"+group+"[]'>";for(key in searchFields){newSearch+="<option value='"+key+"'";if(key==field){newSearch+=" selected='selected'"}newSearch+=">"+searchFields[key]+"</option>"}newSearch+="</select>";newSearch+="</div>";newSearch+="<span class='clearer'></span>";newSearch+="</div>";var searchHolder=$("#group"+group+"SearchHolder");searchHolder.append(newSearch);groupSearches[group]++}function addGroup(firstTerm,firstField,join){if(firstTerm==undefined){firstTerm=""}if(firstField==undefined){firstField=""}if(join==undefined){join=""}var newGroup="";newGroup+="<div id='group"+nextGroupNumber+"' class='group group"+nextGroupNumber%2+"'>";newGroup+="<div class='groupSearchDetails'>";newGroup+="<div class='join'>"+searchMatch+" : ";newGroup+="<select name='bool"+nextGroupNumber+"[]'>";for(key in searchJoins){newGroup+="<option value='"+key+"'";if(key==join){newGroup+=" selected='selected'"}newGroup+=">"+searchJoins[key]+"</option>"}newGroup+="</select>";newGroup+="</div>";newGroup+="<a href='javascript:void(0);' class='delete' id='delete_link_"+nextGroupNumber+"' onclick='deleteGroupJS(this);'>"+deleteSearchGroupString+"</a>";newGroup+="</div>";newGroup+="<div id='group"+nextGroupNumber+"SearchHolder' class='groupSearchHolder'></div>";newGroup+="<div class='addSearch'><a href='javascript:void(0);' class='add' id='add_search_link_"+nextGroupNumber+"' onclick='addSearchJS(this); return false;'>"+addSearchString+"</a></div>";newGroup+="</div>";groupSearches[nextGroupNumber]=0;var search=$("#searchHolder");search.append(newGroup);addSearch(nextGroupNumber,firstTerm,firstField);reSortGroups();return nextGroupNumber-1}function deleteGroupJS(elem){$(elem).parents(".group").remove();reSortGroups();return false}function addSearchJS(group){var groupNum=group.id.replace("add_search_link_","");addSearch(groupNum);return false}function reSortGroups(){var groups=0;$("#searchHolder").children().each(function(){if(this.id!=undefined){if(this.id!="group"+groups){reNumGroup(this,groups)}groups++}});nextGroupNumber=groups;if(nextGroupNumber==1){$("#groupJoin").show()}else{$("#groupJoin").hide()}$("#delete_link_0").css("display",nextGroupNumber==1?"none":"inline");if(nextGroupNumber==0){addGroup()}}function reNumGroup(oldGroup,newNum){var oldId=oldGroup.id;var oldNum=oldId.substring(5,oldId.length);var alt=newNum%2;if(oldNum!=newNum){$(oldGroup).attr({id:"group"+newNum,"class":"group group"+newNum%2});$(".delete",oldGroup).attr("id","delete_link_"+newNum);$('[name="bool'+oldNum+'[]"]',oldGroup).attr("name","bool"+newNum+"[]");$(".add",oldGroup).attr("id","add_search_link_"+newNum);var sHolder=$(".groupSearchHolder",oldGroup).attr("id","group"+newNum+"SearchHolder");$(".terms",sHolder).attr("name","lookfor"+newNum+"[]");$(".field",sHolder).attr("name","type"+newNum+"[]")}}function protectForm(){var e=$("#advSearchForm").elements;var len=e.length;var j,jlen;for(var i=0;i<len;i++){if(e[i].value!=e[i].getAttribute("value")){e[i].setAttribute("value",e[i].value)}if(e[i].type=="select-one"&&e[i].selectedIndex>0){jlen=e[i].options.length;for(j=0;j<jlen;j++){if(e[i].selectedIndex==j){e[i].options[j].setAttribute("selected","selected")}else{e[i].options[j].removeAttribute("selected")}}}}}function filterAll(element){var e=$("#advSearchForm").elements;var len=e.length;for(var i=0;i<len;i++){if(e[i].name=="filter[]"&&e[i].checked!=undefined){e[i].checked=element.checked}}}function jsEntityEncode(str){var new_str=str.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;");return new_str}